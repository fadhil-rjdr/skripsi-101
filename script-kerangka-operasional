import os
from graphviz import Digraph

# Membuat objek Digraph
dot = Digraph(comment='Kerangka Operasional Penelitian')
dot.attr(rankdir='TB', size='12,12')

# Mendefinisikan style
dot.attr('node', shape='rectangle', style='filled', color='lightblue', fontname='Arial', fontsize='10')
dot.attr('edge', fontname='Arial', fontsize='8')

# Menambahkan nodes dan edges
dot.node('A', 'Bursa Efek Indonesia')
dot.node('B', 'Perusahaan Agribisnis\npada Papan Utama')
dot.node('C', 'Variasi Kebutuhan Modal\ndan Pengaruh Kebijakan BI\nterhadap Nilai Pasar Perusahaan')
dot.node('D', 'Analisis Pengaruh Struktur Modal,\nProfitabilitas, dan Faktor Makroekonomi\nterhadap Nilai Pasar Perusahaan')

# Variabel Independen
with dot.subgraph(name='cluster_0') as c:
    c.attr(label='Variabel Independen')
    c.node('E1', 'Struktur Modal\n(DER)')
    c.node('E2', 'Profitabilitas\n(ROE)')
    c.node('E3', 'Pertumbuhan\nPerusahaan')
    c.node('E4', 'Efisiensi Operasional\n(Asset Turnover)')

# Faktor Makroekonomi
with dot.subgraph(name='cluster_1') as c:
    c.attr(label='Faktor Makroekonomi')
    c.node('F1', 'Suku Bunga BI')
    c.node('F2', 'Inflasi')
    c.node('F3', 'Nilai Tukar Rupiah')

dot.node('G', 'Kebijakan Bank Indonesia\n(Variabel Moderator)')
dot.node('H', 'Nilai Pasar Perusahaan\n(PBV)')
dot.node('I', 'Implikasi Manajerial\nPerusahaan Agribisnis')

# Menambahkan edges
dot.edge('A', 'B')
dot.edge('B', 'C')
dot.edge('C', 'D')
dot.edge('E1', 'H')
dot.edge('E2', 'H')
dot.edge('E3', 'H')
dot.edge('E4', 'H')
dot.edge('F1', 'H')
dot.edge('F2', 'H')
dot.edge('F3', 'H')
dot.edge('G', 'H', label='Moderasi')
dot.edge('H', 'I')

# Tentukan jalur output dengan jelas
output_dir = '/Users/massfadhill/Script Skripsi Fadhil'
output_file = os.path.join(output_dir, 'kerangka_operasional.png')

# Pastikan direktori output ada dan dapat ditulis
os.makedirs(output_dir, exist_ok=True)

# Render dan simpan diagram
dot.render(output_file, format='png', cleanup=True)
dot.view()
